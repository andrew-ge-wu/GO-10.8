## If view is anything but article, show teaser
## Note that the $view != "article" check equals to false if $view is not set
#set($rs = $m.context.site.bean.resources.strings)
#set($view = $m.request.httpRequest.attributes.view)
#set($displayTools = $m.request.preview.inPreviewMode && $m.request.preview.inInteractivePreviewMode)
#set($doubleQuote = '"')

#if($displayTools)
  #set($contentEditableObjectName = $tool_preview.getInteractivePreviewEditableObjectName($content.contentId))
  #if($contentEditableObjectName)
    #set($contentEditableAttribute = "polopoly:editableobjectname=$doubleQuote$contentEditableObjectName$doubleQuote")
  #else
    #set($contentEditableAttribute = "")
  #end
<script type="text/javascript">jq.require("/_preview/interactive/article.js")</script>
<div class="polopoly-element" polopoly:contentid="$content.contentId.contentIdString" $contentEditableAttribute>
#end


#if(!$view || $view != "article")
  <div class="element teaser">
  #if($m.request.preview.inPreviewMode)
    #set ($contentIdString = ${content.contentId.contentId.contentIdString})
    #set($statisticsId = "statisticsChart${m.local.controllerContext.renderId}")
    <div class="statisticsChart" id="$statisticsId" polopoly:elementWidth="$m.stack.colwidth" polopoly:contentId="${contentIdString}"></div>
  #end

  ## Create link
  #set($linkContext = $m.request.httpRequest.attributes.linkContext)
  #if ($linkContext)
    #set($path = $tool_path.concat($tool_path.getPathToRoot($linkContext.contentId), $content.contentId))
  #else
    #set($path = $content.parentIds)
  #end
  ## If parent ids of article is invalid, use path to current page
  #if(!$tool_path.isValidPath($path))
    ## If no current page exists, use the invalid path anyway
    #if($m.context.page.contentPath)
      #set($path = $tool_path.concat($m.context.page.contentPath, $content.contentId))
    #end
  #end

  <h1><a href="#link({"path": $path, 'htmlEncodeLink': 'true', "":""})">$!esc.html($content.name)</a></h1>


  #if($content.images.list && $content.images.list.size() > 0)
    #set($image = $content.images.list.get(0).content)
  #end
  #if ($image)
    <a href="#link({"path": $path, 'htmlEncodeLink': 'true', "":""})">
    #imageresource({"contentId": $image.contentId,
                    "derivative": "box_100",
                    "class": "left",
                    "":""})
    </a>
  #end
    <div>
      <p class="lead">
        #if($content.premiumContent)
          <span class="premium-label"><i class="icon-lock"></i> <span>$rs.paywall.premium.content</span></span>
        #end
        $!esc.html($content.lead.value)
      </p>
    </div>
  </div>

#else


  #if($content.titleFontSize.value)
    #set($titleStyle = "style='font-size:" + $content.titleFontSize.value + "px;'")
  #end
  #if($content.leadFontSize.value)
    #set($leadStyle = "style='font-size:" + $content.leadFontSize.value + "px;'")
  #end


  <div class="container">
    <div class="element article#if($m.request.preview.inPreviewMode) editable#end">
  #if($m.request.preview.inPreviewMode)
    #set ($contentIdString = ${content.contentId.contentId.contentIdString})
    #set($statisticsId = "statisticsChart${m.local.controllerContext.renderId}")
      <div class="statisticsChart" id="$statisticsId" polopoly:elementWidth="$m.stack.colwidth" polopoly:contentId="${contentIdString}"></div>
  #end

  #foreach($entry in $content.topimages.list)
    #set($alttext = $!esc.html($entry.meta.alttext.value))
      <div class="image top">
    #imageresource({"contentId": $entry.content.contentId,
                    "derivative": "landscape_490",
                    "alt": $alttext,
                    "": ""})
    #if($entry.meta.imagetext.value)
        <p>$!esc.html($entry.meta.imagetext.value)</p>
    #end
      </div>
  #end
      <div $!titleStyle>
        #if($titleStyle)
          <h1 style="font-size:inherit">$!esc.html($content.name)</h1>
        #else
          <h1>$!esc.html($content.name)</h1>
        #end
      </div>
      <div class="dateLine">
  #if($content.author)
        <span class="author">By <span style="text-transform: uppercase;">$!esc.html($content.author)</span></span>
        <br />
  #end
  #if($content && "$!premiumBundles" != "")
    <span>Premium package: <span style="text-transform: uppercase;color: #B40404;">$!premiumBundles</span></span>
    <br />
  #end
  <span class="date">Published: $date.format("MMMM d, yyyy", $content.publishingDateTime, $m.context.site.bean.resources.locale)</span>
  </div>
    <div class="clearfix">
    #if(!$behindPaywall || $behindPaywall != "true")
      <div class="sideBar">
      #if($m.request.mode == "www")
        <div class="tools">
          <h2>Tools</h2>
          <ul>
            <li><a href="" class="increaseTextSize">Increase textsize</a></li>
            <li><a href="" class="decreaseTextSize">Decrease textsize</a></li>
          </ul>
        </div>
      #end

      <div class="related">
      #if($content.related.list && $content.related.list.size() > 0)
        <h2>Related</h2>
        <ul>
        #foreach($entry in $content.related.list)
          <li><a href="#link({"path": $entry.content.parentIds, 'htmlEncodeLink': 'true', "":""})">$!esc.html($entry.content.name)</a></li>
        #end
        </ul>
      #end

      #foreach($entry in $content.images.list)
        #set($alttext = $!esc.html($entry.meta.alttext.value))
        <div class="element teaser">
        #imageresource({"contentId": $entry.content.contentId,
                    "derivative": "landscape_174",
                    "alt": $alttext,
                    "": ""})
        #if($entry.meta.imagetext.value)
          <p>$!esc.html($entry.meta.imagetext.value)</p>
        #end
        </div>
      #end
      </div>

      ## Render right column elements
      #set($originalColwidth = $m.stack.colwidth)
      #set($m.stack.colwidth = 175)
      #if($content.rightColumn)
        #render({"content": $content.rightColumn, "":""})
      #end
      #if($originalColwidth)
        #set($m.stack.colwidth = $originalColwidth)
      #end
    </div>
    #end
    <div class="leadContainer" $!leadStyle><p class="lead">$!esc.html($content.lead.value)</p></div>
    #if(!$behindPaywall || $behindPaywall != "true")
      <div class="articleBody">
        $!parsedbody
      </div>
    #end
    #if($content.premiumContent && $behindPaywall && $behindPaywall == "true")
      <span class="premium-label"><i class="icon-lock"></i> <span>$rs.paywall.premium.article</span></span>
    #end
    </div>
    #if(!$behindPaywall || $behindPaywall != "true")
      #if($content.elements)
          <div>
          ## Render main column elements
          #render({"content": $content.elements, "":""})
          </div>
      #end
    #end
    </div>
  </div>
  #if($content.premiumContent && $meteredPaywallEnabled)
    #parse("/WEB-INF/velocity/www/meteredwarningelement.vm")
  #end
#end

#if($displayTools)
</div>
#end